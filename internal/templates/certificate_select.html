{{define "content"}}
<div class="auth-card">
    <div class="auth-header">
        <h2 class="ui header" style="color: white;">
            <i class="certificate icon"></i>
            <div class="content">
                Certificate Selection Required
                <div class="sub header" style="color: rgba(255,255,255,0.8);">
                    Please select your eIDAS certificate to continue
                </div>
            </div>
        </h2>
    </div>
    
    <div class="auth-content">
        <div class="ui info message">
            <i class="info circle icon"></i>
            <div class="content">
                <div class="header">Certificate Authentication Required</div>
                <p><strong>{{.RPName}}</strong> requires authentication using your eIDAS organizational certificate.</p>
                <p>Your browser will now display a popup asking you to select a certificate from your local certificate store.</p>
            </div>
        </div>
        
        <div class="ui segment">
            <h4 class="ui header">
                <i class="key icon"></i>
                <div class="content">
                    What happens next?
                    <div class="sub header">The authentication process</div>
                </div>
            </h4>
            
            <div class="ui ordered list">
                <div class="item">
                    <div class="content">
                        <div class="header">Certificate Popup</div>
                        <div class="description">Your browser will show a certificate selection dialog</div>
                    </div>
                </div>
                <div class="item">
                    <div class="content">
                        <div class="header">Select Certificate</div>
                        <div class="description">Choose your eIDAS organizational certificate (QSeal or QSign)</div>
                    </div>
                </div>
                <div class="item">
                    <div class="content">
                        <div class="header">Certificate Validation</div>
                        <div class="description">We'll validate your certificate and extract organization information</div>
                    </div>
                </div>
                <div class="item">
                    <div class="content">
                        <div class="header">Consent Screen</div>
                        <div class="description">Review and authorize the information to be shared</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="ui warning message">
            <i class="exclamation triangle icon"></i>
            <div class="content">
                <div class="header">Important Notes</div>
                <ul class="list">
                    <li>Only eIDAS certificates with organization identifiers are accepted</li>
                    <li>Certificates must be valid (not expired)</li>
                    <li>If no popup appears, check your browser settings</li>
                    <li>You can use smartcards, USB tokens, or software certificates</li>
                </ul>
            </div>
        </div>
        
        <div class="ui segment" style="text-align: center;">
            <div class="ui loading">
                <div class="ui large active inverted dimmer">
                    <div class="ui text loader">Waiting for certificate selection...</div>
                </div>
                <p style="margin-top: 1rem;">
                    <i class="clock outline icon"></i>
                    Please complete the certificate selection in your browser
                </p>
            </div>
        </div>
        
        <div class="ui two buttons">
            <button type="button" class="ui red button" onclick="window.close()">
                <i class="times icon"></i>
                Cancel Authentication
            </button>
            
            <button type="button" class="ui btn-primary button" onclick="location.reload()">
                <i class="refresh icon"></i>
                Retry Certificate Selection
            </button>
        </div>
    </div>
</div>

<script>
// Auto-refresh the page after a delay to check if certificate was selected
setTimeout(function() {
    location.reload();
}, 5000); // Refresh every 5 seconds

// Show a more prominent message if no certificate popup appears
setTimeout(function() {
    document.querySelector('.ui.loading').innerHTML = `
        <div class="ui warning message">
            <i class="exclamation triangle icon"></i>
            <div class="content">
                <div class="header">No Certificate Popup Detected</div>
                <p>If you haven't seen a certificate selection popup, please:</p>
                <ul>
                    <li>Check that you have eIDAS certificates installed</li>
                    <li>Try refreshing the page</li>
                    <li>Check your browser's certificate settings</li>
                    <li>Ensure your certificate is not expired</li>
                </ul>
            </div>
        </div>
    `;
}, 10000); // Show warning after 10 seconds
</script>
{{end}}
